<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--[if IE]><![endif]-->
  <title>Atlas</title>


  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/4.1.0/css/fixedColumns.semanticui.min.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="shortcut icon" href="favicon.ico">

  <meta name="description" content="">
  <meta name="robots" content="all">
  <meta property="og:title" content="Template">
  <meta property="og:type" content="website">
  <meta property="og:description" content="">
  <meta property="og:url" content="">
  <meta property="og:site_name" content="Template">
  <meta property="og:image" content="assets/img/share.jpg">

  <!--[if lt IE 9]><script src="assets/js/vendor/html5shiv.min.js"></script><![endif]-->

</head>

<body class="home">

  <!-- header -->
  <header id="internal">
    <div class="container-full">
      <div class="grid">
        <div class="item logo">
          <a href="#">
            <img src="assets/images/logo_internal.png" alt="">
          </a>
        </div>
        <div class="item">
          <nav>
            <ul>
              <li><a href="#">Quem Somos</a></li>
              <li><a href="#">Biblioteca Virtual</a></li>
              <li class="subitem">
                <a href="#">
                  Produtos
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#chevron"></use>
                  </svg>
                </a>
              </li>
              <li><a href="#">Projetos</a></li>
              <li><a href="#">Eventos & Notícias</a></li>
              <li><a href="#">Contato</a></li>
            </ul>
          </nav>
        </div>
        <div class="item search">
          <div class="box">
            <input type="text" placeholder="Buscar">
            <button>
              <svg class="icon">
                <use xlink:href="assets/img/icons.svg#search"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- end:header -->

  <!-- main -->
  <main>
    <div class="container-full">
      <!-- grid-primary -->
      <div class="grid-primary">
        <!-- sidebar -->
        <div class="sidebar">
          <div class="top-side">
            <div class="logo">
              <a href="#">
                <img src="assets/images/logo.png" alt="">
              </a>
            </div>
            <a href="#" class="btn-menu">
              <svg class="icon">
              <use xlink:href="assets/img/icons.svg#menu"></use>
            </svg>
            </a>
          </div>
          <div class="box-menu">
            <ul>
              <li>
                <a href="pre-home.html">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#info"></use>
                  </svg><span>Apresentação</span>
                </a>
              </li>
              <li>
                <a href="home.html">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#home"></use>
                  </svg><span>Página Inicial</span>
                </a>
              </li>
              <li>
                <a href="analise-por-pais.html">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#globe"></use>
                  </svg><span>Análise por País</span>
                </a>
              </li>
              <li>
                <a href="base-industrial-de-defesa.html">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#shield"></use>
                  </svg><span>Indústria de Defesa</span>
                  <svg class="icon rotate90">
                    <use xlink:href="assets/img/icons.svg#chevron"></use>
                  </svg>
                </a>
              </li>
              <li class="act">
                <a href="gastos-militares.html">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#dollar-sign"></use>
                  </svg><span>Gastos Militares</span>
                </a>
              </li>
              <li>
                <a href="">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#flag"></use>
                  </svg><span>Operações de Paz</span>
                </a>
              </li>
              <li>
                <a href="">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#crosshair"></use>
                  </svg><span>Transferência de Armamentos</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!-- end:sidebar -->
        <!-- content -->
        <div class="content pbottom-30">
          <div class="product pbottom-0">
            <!-- title -->
            <div class="title">
              <h1>Base Industrial de Defesa</h1>
              <!-- btns-box -->
              <div class="btns-box">
                <a href="assets/planilhas/gastos-militares.xlsx" download class="down text">
                  <svg class="icon">
                    <use xlink:href="assets/img/icons.svg#download"></use>
                  </svg> Arquivos
                </a>
              </div>
              <!-- end:btns-box -->
              <div class="filter-nation small-padding">
                <label for="">Selecionar país</label>
                <select name="" id="countryAll">
                </select>
              </div>
              <!-- div class="filter-segment small-padding">
                <label for="">Segmento</label>
                <select name="" id="">
                  <option value="ar">Argentina</option>
                </select>
              </div -->
            </div>
            <!-- end:title -->

            <div class="grid-country">
              <div class="cont pbottom-50">
                <!-- list-box -->
                <div class="list-box two mtop-35">
                  <div class="box country-name transparent">
                    <div class="avatar">
                      <img src="assets/images/bandeira-brasil.png" alt="">
                    </div>
                    <h1>Brasil</h1>
                  </div>
                  <div class="box country-data transparent">
                    <span>Gastos Militares (R$)</span>
                    <span class="val">R$ 101.701.400,00</span>
                  </div>
                </div>
                <!-- list-box -->



                <!-- list-box -->
                <div class="list-box two mtop-55">
                  <div class="box heightAuto graphic">
                    <div class="header">
                      <h3>Em moeda nacional
                        <svg class="icon">
                          <use xlink:href="assets/img/icons.svg#info"></use>
                        </svg>
                      </h3>
                      <!-- btns-box -->
                      <div class="btns-box">
                        <a href="assets/planilhas/gastos-militares.xlsx" download class="down">
                          <svg class="icon">
                            <use xlink:href="assets/img/icons.svg#download"></use>
                          </svg>
                        </a>
                      </div>
                      <!-- end:btns-box -->
                    </div>
                    <div class="graphics moedalocalL">
                      <canvas id="moedalocal"></canvas>
                    </div>
                  </div>
                  <div class="box heightAuto graphic">
                    <div class="header">
                      <h3>Em dólar constante
                        <svg class="icon">
                          <use xlink:href="assets/img/icons.svg#info"></use>
                        </svg>
                      </h3>
                      <!-- btns-box -->
                      <div class="btns-box">
                        <a href="assets/planilhas/gastos-militares.xlsx" download class="down">
                          <svg class="icon">
                            <use xlink:href="assets/img/icons.svg#download"></use>
                          </svg>
                        </a>
                      </div>
                      <!-- end:btns-box -->
                    </div>
                    <div class="graphics dolarL">
                      <canvas id="dolar"></canvas>
                    </div>
                  </div>
                  <div class="box heightAuto graphic">
                    <div class="header">
                      <h3>Em % do PIB
                        <svg class="icon">
                          <use xlink:href="assets/img/icons.svg#info"></use>
                        </svg>
                      </h3>
                      <!-- btns-box -->
                      <div class="btns-box">
                        <a href="assets/planilhas/gastos-militares.xlsx" download class="down">
                          <svg class="icon">
                            <use xlink:href="assets/img/icons.svg#download"></use>
                          </svg>
                        </a>
                      </div>
                      <!-- end:btns-box -->
                    </div>
                    <div class="graphics pibL">
                      <canvas id="pib"></canvas>
                    </div>
                  </div>
                  <div class="box heightAuto graphic">
                    <div class="header">
                      <h3>Per capita (US$ correntes)
                        <svg class="icon">
                          <use xlink:href="assets/img/icons.svg#info"></use>
                        </svg>
                      </h3>
                      <!-- btns-box -->
                      <div class="btns-box">
                        <a href="assets/planilhas/gastos-militares.xlsx" download class="down">
                          <svg class="icon">
                            <use xlink:href="assets/img/icons.svg#download"></use>
                          </svg>
                        </a>
                      </div>
                      <!-- end:btns-box -->
                    </div>
                    <div class="graphics percapitaldolarL">
                      <canvas id="percapitaldolar"></canvas>
                    </div>
                  </div>
                  <div class="box heightAuto graphic">
                    <div class="header">
                      <h3>Em % do gasto governamental
                        <svg class="icon">
                          <use xlink:href="assets/img/icons.svg#info"></use>
                        </svg>
                      </h3>
                      <!-- btns-box -->
                      <div class="btns-box">
                        <a href="assets/planilhas/gastos-militares.xlsx" download class="down">
                          <svg class="icon">
                            <use xlink:href="assets/img/icons.svg#download"></use>
                          </svg>
                        </a>
                      </div>
                      <!-- end:btns-box -->
                    </div>
                    <div class="graphics governoL">
                      <canvas id="governo"></canvas>
                    </div>
                  </div>
                </div>
                <!-- list-box -->
              </div>
              <div class="side">
                <!-- subtitle -->
                <div class="subtitle">
                  <h2>Ranking por % do PIB
                    <svg class="icon">
                      <use xlink:href="assets/img/icons.svg#info"></use>
                    </svg>
                  </h2>
                </div>
                <!-- end:subtitle -->
                <table id="table_id">
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>



          </div>
          <div class="footer">
            <p>©2022 Atlas - GEDES</p>
          </div>
        </div>
        <!-- end:content -->
      </div>
      <!-- end:grid-primary -->
    </div>
  </main>
  <!-- end:main -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedcolumns/4.1.0/js/dataTables.fixedColumns.min.js"></script>
  <script src="assets/js/bundle.js"></script>
  <!-- script src="assets/js/bundle.min.js"></script -->
  <script>
    function removeAccents($text) {
      $text = $text.toLowerCase();
      $text = $text.replace(new RegExp('[ÁÀÂÃ]', 'gi'), 'a');
      $text = $text.replace(new RegExp('[ÉÈÊ]', 'gi'), 'e');
      $text = $text.replace(new RegExp('[ÍÌÎ]', 'gi'), 'i');
      $text = $text.replace(new RegExp('[ÓÒÔÕ]', 'gi'), 'o');
      $text = $text.replace(new RegExp('[ÚÙÛ]', 'gi'), 'u');
      $text = $text.replace(new RegExp('[Ç]', 'gi'), 'c');
      return $text;
    }

    function gastosMilitares($url, $change) {
      $.ajax({
        url: $url,
        dataType: 'xml',

        // Caso tenha encontrato o arquivo, leio os dados do xml
        success: function(xml) {
          let $count = 0;
          let labels = [];
          let moedalocal = [];
          let dolar = [];
          let pib = [];
          let percapitaldolar = [];
          let governo = [];
          //let moedalocalG = null;
          $(xml).find('Row').each(function() {
            if ($count != 0) {
              $($(this)[0].children).each(function() {
                if ($(this)[0].textContent == 'null') {
                  $html += '--';
                } else {
                  if ($count === 1) {
                    labels.push($(this)[0].textContent);
                  } else if ($count === 2) {
                    moedalocal.push($(this)[0].textContent);
                  } else if ($count === 3) {
                    dolar.push($(this)[0].textContent);
                  } else if ($count === 4) {
                    pib.push(($(this)[0].textContent * 100));
                  } else if ($count === 5) {
                    percapitaldolar.push($(this)[0].textContent);
                  } else if ($count === 6) {
                    governo.push($(this)[0].textContent);
                  }
                }
              });
            }
            $count++;
          });

          // console.log(labels);
          // console.log(moedalocal);
          // console.log(dolar);
          // console.log(pib);
          // console.log(percapitaldolar);
          // console.log(governo);


          /*const myChart = new Chart($('#myChart'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Em moeda nacional',
                data: moedalocal,
                yAxisID: 'moedalocal'
              }, {
                type: 'line',
                label: 'Em % PIB',
                data: pib,
                borderColor: 'rgba(0, 0, 0, 1)',
                borderWidth: 1,
                yAxisID: 'pib'
              }],
              labels: labels
            },
            options: {
              responsive: true,
              legend: {
                display: false,
              },
              scales: {
                moedalocal: {
                  beginAtZero: true,
                  type: 'linear',
                  position: 'left',
                },
                pib: {
                  beginAtZero: true,
                  type: 'linear',
                  position: "right",
                  grid: {
                    display: false
                  },
                }
              }
            }
          });*/
          if ($change == 1) {
            //console.log('moedalocalG != null');
            //moedalocalG.destroy();
            $("canvas#moedalocal").remove();
            $("div.moedalocalL").append('<canvas id="moedalocal"></canvas>');

            $("canvas#dolar").remove();
            $("div.dolarL").append('<canvas id="dolar"></canvas>');

            $("canvas#pib").remove();
            $("div.pibL").append('<canvas id="pib"></canvas>');

            $("canvas#percapitaldolar").remove();
            $("div.percapitaldolarL").append('<canvas id="percapitaldolar"></canvas>');

            $("canvas#governo").remove();
            $("div.governoL").append('<canvas id="governo"></canvas>');

          }
          const moedalocalG = new Chart($('#moedalocal'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Bar Dataset',
                data: moedalocal,
              }],
              labels: labels
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                }
              }
            }
          });
          const dolarG = new Chart($('#dolar'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Bar Dataset',
                data: dolar,
              }],
              labels: labels
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                }
              }
            }
          });
          const pibG = new Chart($('#pib'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Bar Dataset',
                data: pib,
              }],
              labels: labels
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                }
              }
            }
          });
          const percapitaldolarG = new Chart($('#percapitaldolar'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Bar Dataset',
                data: percapitaldolar,
              }],
              labels: labels
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                }
              }
            }
          });
          const governoG = new Chart($('#governo'), {
            data: {
              datasets: [{
                type: 'bar',
                label: 'Bar Dataset',
                data: governo,
              }],
              labels: labels
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                }
              }
            }
          });
          var lastmoedalocal = moedalocal[moedalocal.length - 1];
          $('.country-data .val').html('R$ ' + parseInt(lastmoedalocal).toLocaleString());

        }
      });
    };
    gastosMilitares('assets/planilhas/gastos-militares-brasil.xml', 0);

    $('#countryAll').on('change', function() {
      var $this = $(this).val();
      var $name = $(this).find(":selected").text();
      gastosMilitares('assets/planilhas/gastos-militares-' + $this + '.xml', 1);
      $('.country-name h1').html($name);
      $('.country-name .avatar img').attr('src', 'assets/images/bandeira-' + $this + '.png');
      return false;
    });

    $.ajax({
      url: 'assets/planilhas/gastos-militares-pib.xml',
      dataType: 'xml',

      // Caso tenha encontrato o arquivo, leio os dados do xml
      success: function(xml) {
        var $count = 1;
        let countryAll = [];
        let country = {};
        let pib = [];
        $(xml).find('Row').each(function() {
          var cou = '';
          var val = '';
          var value = '';
          $($(this)[0].children).each(function() {
            if ($count == 1) {
              cou = $(this)[0].textContent;
              countryAll.push($(this)[0].textContent);
            } else {
              val = $(this)[0].textContent * 100;
              value = val.toFixed(2);
              $count = 0;
            }
            country[cou] = value;
            $count++;
          });

        });
        var numb = 1;
        $.each(country, function(index, value) {
          if (value != 0) {
            $('#table_id').append('<tr><td>' + numb + '</td><td>' + index + '</td><td>' + value + '</td></tr>');
          }
          numb++;
        });
        //console.log(countryAll.sort());
        $.each(countryAll.sort(), function(index, value) {
          let act = value == 'Brasil' ? 'selected' : '';
          $('#countryAll').append('<option ' + act + ' value="' + removeAccents(value.toLowerCase()) + '">' + value + '</option>');
        });

      }
    });
  </script>

</body>

</html>